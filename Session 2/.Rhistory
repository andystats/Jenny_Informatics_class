knitr::opts_chunk$set(echo = TRUE,
error=FALSE,
warning = FALSE,
message= FALSE)
#install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(zoo)
library(ggthemes)
mydata <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"), na.strings = c("", "NA"))
#deaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"), na.strings = c("", "NA"))
View(mydata)
mydata <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"), na.strings = c("", "NA"))
deaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"), na.strings = c("", "NA"))
knitr::opts_chunk$set(echo = TRUE,
error=FALSE,
warning = FALSE,
message= FALSE)
#install.packages("tidyverse")
library(tidyverse)
library(ggplot2)
library(ggpubr)
theme_set(theme_pubr())
library(zoo)
library(ggthemes)
mydata <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_US.csv"), na.strings = c("", "NA"))
deaths <- read.csv(url("https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_US.csv"), na.strings = c("", "NA"))
State <- "Utah"
k = 20 #future days
CASES <- mydata %>%
filter(Province_State ==State) %>%
select(starts_with("X"))
Y<- colSums(CASES)
n <- as.numeric(length(Y))
temp1 <- data.frame(y = Y, x = seq(1:n))
temp1$date<-row.names(temp1)
temp <- temp1 %>% filter(y > 0)
(date1<-substr(temp[1,]$date, 2, 8))
(date<-substr(temp[temp$x==max(temp$x),]$date, 2, 8))
(Max <- temp[temp$x==max(temp$x),]$y)
head(temp)
last_obs <- max(temp$x)
next_last_obs <- last_obs - 1
seven_days_ago <- last_obs - 7
new_cases <- temp[ temp$x ==last_obs , 1] - temp[ temp$x ==next_last_obs , 1]
one_day_percent <- (temp[ temp$x ==last_obs , 1] - temp[ temp$x ==next_last_obs , 1])/temp[ temp$x ==next_last_obs, 1] *100
seven_days_percent <- (temp[ temp$x ==last_obs , 1] - temp[ temp$x ==seven_days_ago , 1])/temp[ temp$x ==seven_days_ago, 1] *100
#Z <- nls(y ~ SSlogis(x, Asym, xmid, scal), temp); ZZ<-summary(Z)
# State <- "Utah"
# CASES <- mydata %>%
#   filter(Province_State ==State) %>%
#   select(starts_with("X"))
#
#
# Y<- colSums(CASES)
# n <- as.numeric(length(Y))
#
# temp1 <- data.frame(y = Y, x = seq(1:n))
# temp1$date<-row.names(temp1)
#
# temp <- temp1 %>% filter(y > 0)
y <- temp$y
x <- temp$x
Z <- nls(y ~  (( k1 / (1 + exp( (-log(81)/a1) * (x - b1)))) +
( k2 / (1 + exp( (-log(81)/a2) * (x - b2))))),
start=c(a1=87,k1=38000,b1=150,
a2=104,k2=400000,b2=300))
ZZ<-summary(Z)
peak <- ZZ$parameters[1]
midpoint <- temp %>%
filter(x == round(ZZ$parameters[2])) %>%
mutate(date = str_sub(date, 2, 8)) %>%
select(date)
round(peak) # estimated asymptote
midpoint # date of inflection point
midpoint # date of inflection point
AIC(Z) # AIC = -2LL + 2k
BIC(Z)
#  pdf("curve.pdf", width = 12, height = 10)
# png(file = "curve.png", width = 1080, height = 900, units = "px", pointsize = 14)
par(family="serif")
plot(temp$x, temp$y, ylab = "COVID SARS-2 Confirmed Cases", xlab="", xlim =c(min(temp$x),n+k),
ylim=c(0, max(temp$y) + 0.25*max(temp$y)), type="l", col="navy", lwd=3,
axes=F,
main = paste("COVID-19 cases in", State, " (updated", date , ")"),
sub = "Using 2019 Novel Coronavirus COVID-19 (2019-nCoV)
Data Repository by Johns Hopkins CSSE")
axis(2)
axis(1, at=c(temp[1,2], max(temp$x) ), lab=c(date1, date))
lines(seq(1:n), predict(Z, list(x = seq(1:n))), lwd=2, col='blue', lty=3)
abline( h = max(temp$y), lty=3)
#abline( h = ZZ$parameters[1], lty=3)
#abline(v=temp[temp$date == "X8.18.20",]$x, lty=2, col="red")
text(max(temp$x)-120, max(temp$y) -24000, paste("Daily new cases = ", new_cases ))
text(max(temp$x)-120, max(temp$y)-16000, paste("Daily percent increase = ", round(one_day_percent,1), "%" ))
text(max(temp$x)-120, max(temp$y)-8000, paste("Seven-day percent increase = ", round(seven_days_percent,1), "%" ))
#text(max(temp$x)-80, ZZ$parameters[1]-2000, paste("Estimated case asymptote = ", round(ZZ$parameters[1])), col="grey")
#text(n,  1000, paste("model AIC = ", round(AIC(Z),2), "\n (smaller is better)"),col="grey")
Z10 <- round(predict(Z, list(x = seq(n+1,n+k))))
#k-day forecast
Z10[1:k]
lines(seq(n+1,n+k), Z10[1:k], col="lightblue", lwd=2, lty=2)
# dev.off()
pdf("curve.pdf", width = 12, height = 10)
# png(file = "curve.png", width = 1080, height = 900, units = "px", pointsize = 14)
par(family="serif")
plot(temp$x, temp$y, ylab = "COVID SARS-2 Confirmed Cases", xlab="", xlim =c(min(temp$x),n+k),
ylim=c(0, max(temp$y) + 0.25*max(temp$y)), type="l", col="navy", lwd=3,
axes=F,
main = paste("COVID-19 cases in", State, " (updated", date , ")"),
sub = "Using 2019 Novel Coronavirus COVID-19 (2019-nCoV)
Data Repository by Johns Hopkins CSSE")
axis(2)
axis(1, at=c(temp[1,2], max(temp$x) ), lab=c(date1, date))
lines(seq(1:n), predict(Z, list(x = seq(1:n))), lwd=2, col='blue', lty=3)
abline( h = max(temp$y), lty=3)
#abline( h = ZZ$parameters[1], lty=3)
#abline(v=temp[temp$date == "X8.18.20",]$x, lty=2, col="red")
text(max(temp$x)-120, max(temp$y) -24000, paste("Daily new cases = ", new_cases ))
text(max(temp$x)-120, max(temp$y)-16000, paste("Daily percent increase = ", round(one_day_percent,1), "%" ))
text(max(temp$x)-120, max(temp$y)-8000, paste("Seven-day percent increase = ", round(seven_days_percent,1), "%" ))
#text(max(temp$x)-80, ZZ$parameters[1]-2000, paste("Estimated case asymptote = ", round(ZZ$parameters[1])), col="grey")
#text(n,  1000, paste("model AIC = ", round(AIC(Z),2), "\n (smaller is better)"),col="grey")
Z10 <- round(predict(Z, list(x = seq(n+1,n+k))))
#k-day forecast
Z10[1:k]
lines(seq(n+1,n+k), Z10[1:k], col="lightblue", lwd=2, lty=2)
dev.off()
pdf("curve.pdf", width = 12, height = 12)
# png(file = "curve.png", width = 1080, height = 900, units = "px", pointsize = 14)
par(family="serif")
plot(temp$x, temp$y, ylab = "COVID SARS-2 Confirmed Cases", xlab="", xlim =c(min(temp$x),n+k),
ylim=c(0, max(temp$y) + 0.25*max(temp$y)), type="l", col="navy", lwd=3,
axes=F,
main = paste("COVID-19 cases in", State, " (updated", date , ")"),
sub = "Using 2019 Novel Coronavirus COVID-19 (2019-nCoV)
Data Repository by Johns Hopkins CSSE")
axis(2)
axis(1, at=c(temp[1,2], max(temp$x) ), lab=c(date1, date))
lines(seq(1:n), predict(Z, list(x = seq(1:n))), lwd=2, col='blue', lty=3)
abline( h = max(temp$y), lty=3)
#abline( h = ZZ$parameters[1], lty=3)
#abline(v=temp[temp$date == "X8.18.20",]$x, lty=2, col="red")
text(max(temp$x)-120, max(temp$y) -24000, paste("Daily new cases = ", new_cases ))
text(max(temp$x)-120, max(temp$y)-16000, paste("Daily percent increase = ", round(one_day_percent,1), "%" ))
text(max(temp$x)-120, max(temp$y)-8000, paste("Seven-day percent increase = ", round(seven_days_percent,1), "%" ))
#text(max(temp$x)-80, ZZ$parameters[1]-2000, paste("Estimated case asymptote = ", round(ZZ$parameters[1])), col="grey")
#text(n,  1000, paste("model AIC = ", round(AIC(Z),2), "\n (smaller is better)"),col="grey")
Z10 <- round(predict(Z, list(x = seq(n+1,n+k))))
#k-day forecast
Z10[1:k]
lines(seq(n+1,n+k), Z10[1:k], col="lightblue", lwd=2, lty=2)
dev.off()
mydata0 <-read.csv(url("https://raw.githubusercontent.com/CivilServiceUSA/us-governors/master/us-governors/data/us-governors.csv"), na.strings = c("", "NA")) %>%
dplyr::select(state_code, state_name, party) %>%
rename(state = state_code)
mydata2 <-read.csv(url("https://covidtracking.com/api/v1/states/daily.csv"), na.strings = c("", "NA"))
mydf <- merge(mydata0, mydata2 , by="state")
mydf$Date <- as.Date(as.character(mydf$date), "%Y %m %d")
View(mydf)
